/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var _middlewares_compose_middlewares__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./middlewares/compose-middlewares */ \"(middleware)/./middlewares/compose-middlewares.ts\");\n/* harmony import */ var _middlewares_with_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./middlewares/with-auth */ \"(middleware)/./middlewares/with-auth.ts\");\n/* harmony import */ var _middlewares_with_custom_urls__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./middlewares/with-custom-urls */ \"(middleware)/./middlewares/with-custom-urls.ts\");\n/* harmony import */ var _middlewares_with_custom_urls__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_middlewares_with_custom_urls__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst middleware = (0,_middlewares_compose_middlewares__WEBPACK_IMPORTED_MODULE_0__.composeMiddlewares)(_middlewares_with_auth__WEBPACK_IMPORTED_MODULE_1__.withAuth, _middlewares_with_custom_urls__WEBPACK_IMPORTED_MODULE_2__.withCustomUrls);\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - _vercel (vercel internals, eg: web vitals)\n     * - favicon.ico (favicon file)\n     */ \"/((?!api|_next/static|_next/image|_vercel|favicon.ico).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBdUU7QUFDcEI7QUFDYTtBQUV6RCxNQUFNRyxhQUFhSCxvRkFBa0JBLENBQUNDLDREQUFRQSxFQUFFQyx5RUFBY0EsRUFBRTtBQUVoRSxNQUFNRSxTQUFTO0lBQ3BCQyxTQUFTO1FBQ1A7Ozs7Ozs7S0FPQyxHQUNEO0tBQ0Q7QUFDSCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL21pZGRsZXdhcmUudHM/NDIyZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb21wb3NlTWlkZGxld2FyZXMgfSBmcm9tICcuL21pZGRsZXdhcmVzL2NvbXBvc2UtbWlkZGxld2FyZXMnO1xuaW1wb3J0IHsgd2l0aEF1dGggfSBmcm9tICcuL21pZGRsZXdhcmVzL3dpdGgtYXV0aCc7XG5pbXBvcnQgeyB3aXRoQ3VzdG9tVXJscyB9IGZyb20gJy4vbWlkZGxld2FyZXMvd2l0aC1jdXN0b20tdXJscyc7XG5cbmV4cG9ydCBjb25zdCBtaWRkbGV3YXJlID0gY29tcG9zZU1pZGRsZXdhcmVzKHdpdGhBdXRoLCB3aXRoQ3VzdG9tVXJscyk7XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIG1hdGNoZXI6IFtcbiAgICAvKlxuICAgICAqIE1hdGNoIGFsbCByZXF1ZXN0IHBhdGhzIGV4Y2VwdCBmb3IgdGhlIG9uZXMgc3RhcnRpbmcgd2l0aDpcbiAgICAgKiAtIGFwaSAoQVBJIHJvdXRlcylcbiAgICAgKiAtIF9uZXh0L3N0YXRpYyAoc3RhdGljIGZpbGVzKVxuICAgICAqIC0gX25leHQvaW1hZ2UgKGltYWdlIG9wdGltaXphdGlvbiBmaWxlcylcbiAgICAgKiAtIF92ZXJjZWwgKHZlcmNlbCBpbnRlcm5hbHMsIGVnOiB3ZWIgdml0YWxzKVxuICAgICAqIC0gZmF2aWNvbi5pY28gKGZhdmljb24gZmlsZSlcbiAgICAgKi9cbiAgICAnLygoPyFhcGl8X25leHQvc3RhdGljfF9uZXh0L2ltYWdlfF92ZXJjZWx8ZmF2aWNvbi5pY28pLiopJyxcbiAgXSxcbn07XG4iXSwibmFtZXMiOlsiY29tcG9zZU1pZGRsZXdhcmVzIiwid2l0aEF1dGgiLCJ3aXRoQ3VzdG9tVXJscyIsIm1pZGRsZXdhcmUiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ }),

/***/ "(middleware)/./middlewares/with-custom-urls.ts":
/*!*****************************************!*\
  !*** ./middlewares/with-custom-urls.ts ***!
  \*****************************************/
/***/ (() => {

eval("// import { cookies } from 'next/headers';\n// import { NextRequest, NextResponse } from 'next/server';\n// import { z } from 'zod';\n// import { getSessionCustomerId } from '~/auth';\n// import { StorefrontStatusType } from '~/client/generated/graphql';\n// import { getRoute } from '~/client/queries/get-route';\n// import { getStoreStatus } from '~/client/queries/get-store-status';\n// import { kv } from '../lib/kv';\n// import { type MiddlewareFactory } from './compose-middlewares';\n// type Node = Awaited<ReturnType<typeof getRoute>>;\n// interface RouteCache {\n//   node: Node;\n//   expiryTime: number;\n// }\n// const STORE_STATUS_KEY = 'storeStatus';\n// interface StorefrontStatusCache {\n//   status: StorefrontStatusType;\n//   expiryTime: number;\n// }\n// const createRewriteUrl = (path: string, request: NextRequest) => {\n//   const url = new URL(path, request.url);\n//   url.search = request.nextUrl.search;\n//   return url;\n// };\n// const StorefrontStatusCacheSchema = z.object({\n//   status: z.nativeEnum(StorefrontStatusType),\n//   expiryTime: z.number(),\n// });\n// const RouteCacheSchema = z.object({\n//   node: z.nullable(z.object({ __typename: z.string(), entityId: z.optional(z.number()) })),\n//   expiryTime: z.number(),\n// });\n// const getExistingRouteInfo = async (request: NextRequest) => {\n//   try {\n//     const pathname = request.nextUrl.pathname;\n//     const [routeCache, statusCache] = await kv.mget<RouteCache | StorefrontStatusCache>(\n//       pathname,\n//       STORE_STATUS_KEY,\n//     );\n//     if (statusCache && statusCache.expiryTime < Date.now()) {\n//       void fetch(new URL(`/api/revalidate/store-status`, request.url), {\n//         method: 'POST',\n//         headers: {\n//           'x-internal-token': process.env.BIGCOMMERCE_CUSTOMER_IMPERSONATION_TOKEN ?? '',\n//         },\n//       });\n//     }\n//     if (routeCache && routeCache.expiryTime < Date.now()) {\n//       void fetch(new URL(`/api/revalidate/route`, request.url), {\n//         method: 'POST',\n//         body: JSON.stringify({ pathname }),\n//         headers: {\n//           'x-internal-token': process.env.BIGCOMMERCE_CUSTOMER_IMPERSONATION_TOKEN ?? '',\n//         },\n//       });\n//     }\n//     const parsedRoute = RouteCacheSchema.safeParse(routeCache);\n//     const parsedStatus = StorefrontStatusCacheSchema.safeParse(statusCache);\n//     return {\n//       // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n//       node: parsedRoute.success ? (parsedRoute.data.node as Node) : undefined,\n//       status: parsedStatus.success ? parsedStatus.data.status : undefined,\n//     };\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//     return {\n//       node: undefined,\n//       status: undefined,\n//     };\n//   }\n// };\n// const setKvStatus = async (status?: StorefrontStatusType | null) => {\n//   try {\n//     const expiryTime = Date.now() + 1000 * 60 * 5; // 5 minutes;\n//     await kv.set(STORE_STATUS_KEY, { status, expiryTime });\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//   }\n// };\n// const setKvRoute = async (request: NextRequest, node: Node) => {\n//   try {\n//     const expiryTime = Date.now() + 1000 * 60 * 30; // 30 minutes;\n//     await kv.set(request.nextUrl.pathname, { node, expiryTime });\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//   }\n// };\n// const getRouteInfo = async (request: NextRequest) => {\n//   try {\n//     let { node, status } = await getExistingRouteInfo(request);\n//     if (status === undefined) {\n//       const newStatus = await getStoreStatus();\n//       if (newStatus) {\n//         status = newStatus;\n//         await setKvStatus(status);\n//       }\n//     }\n//     if (node === undefined) {\n//       const newNode = await getRoute(request.nextUrl.pathname);\n//       node = newNode;\n//       await setKvRoute(request, node);\n//     }\n//     return { node, status };\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//     return {\n//       node: undefined,\n//       status: undefined,\n//     };\n//   }\n// };\n// export const withCustomUrls: MiddlewareFactory = (next) => {\n//   return async (request, event) => {\n//     const { node, status } = await getRouteInfo(request);\n//     if (status === 'MAINTENANCE') {\n//       // 503 status code not working - https://github.com/vercel/next.js/issues/50155\n//       return NextResponse.rewrite(new URL(`/maintenance`, request.url), { status: 503 });\n//     }\n//     const customerId = await getSessionCustomerId();\n//     const cartId = cookies().get('cartId');\n//     let postfix = '';\n//     if (!request.nextUrl.search && !customerId && !cartId && request.method === 'GET') {\n//       postfix = '/static';\n//     }\n//     switch (node?.__typename) {\n//       case 'Brand': {\n//         const url = createRewriteUrl(`/brand/${node.entityId}${postfix}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       case 'Category': {\n//         const url = createRewriteUrl(`/category/${node.entityId}${postfix}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       case 'Product': {\n//         const url = createRewriteUrl(`/product/${node.entityId}${postfix}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       case 'ContactPage':\n//       case 'NormalPage': {\n//         const { pathname } = new URL(request.url);\n//         const url = createRewriteUrl(`/bc-page${pathname}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       default: {\n//         const { pathname } = new URL(request.url);\n//         if (pathname === '/' && postfix) {\n//           const url = createRewriteUrl(postfix, request);\n//           return NextResponse.rewrite(url);\n//         }\n//         return next(request, event);\n//       }\n//     }\n//   };\n// };\n// import { cookies } from 'next/headers';\n// import { NextRequest, NextResponse } from 'next/server';\n// import { z } from 'zod';\n// import { getSessionCustomerId } from '~/auth';\n// import { StorefrontStatusType } from '~/client/generated/graphql';\n// import { getRoute } from '~/client/queries/get-route';\n// import { getStoreStatus } from '~/client/queries/get-store-status';\n// import { kv } from '../lib/kv';\n// import { type MiddlewareFactory } from './compose-middlewares';\n// type Node = Awaited<ReturnType<typeof getRoute>>;\n// interface RouteCache {\n//   node: Node;\n//   expiryTime: number;\n// }\n// const STORE_STATUS_KEY = 'storeStatus';\n// interface StorefrontStatusCache {\n//   status: StorefrontStatusType;\n//   expiryTime: number;\n// }\n// const createRewriteUrl = (path: string, request: NextRequest) => {\n//   const url = new URL(path, request.url);\n//   url.search = request.nextUrl.search;\n//   return url;\n// };\n// const StorefrontStatusCacheSchema = z.object({\n//   status: z.nativeEnum(StorefrontStatusType),\n//   expiryTime: z.number(),\n// });\n// const RouteCacheSchema = z.object({\n//   node: z.nullable(z.object({ __typename: z.string(), entityId: z.optional(z.number()) })),\n//   expiryTime: z.number(),\n// });\n// const getExistingRouteInfo = async (request: NextRequest) => {\n//   try {\n//     const pathname = request.nextUrl.pathname;\n//     const [routeCache, statusCache] = await kv.mget<RouteCache | StorefrontStatusCache>(\n//       pathname,\n//       STORE_STATUS_KEY,\n//     );\n//     if (statusCache && statusCache.expiryTime < Date.now()) {\n//       void fetch(new URL(`/api/revalidate/store-status`, request.url), {\n//         method: 'POST',\n//         headers: {\n//           'x-internal-token': process.env.BIGCOMMERCE_CUSTOMER_IMPERSONATION_TOKEN ?? '',\n//         },\n//       });\n//     }\n//     if (routeCache && routeCache.expiryTime < Date.now()) {\n//       void fetch(new URL(`/api/revalidate/route`, request.url), {\n//         method: 'POST',\n//         body: JSON.stringify({ pathname }),\n//         headers: {\n//           'x-internal-token': process.env.BIGCOMMERCE_CUSTOMER_IMPERSONATION_TOKEN ?? '',\n//         },\n//       });\n//     }\n//     const parsedRoute = RouteCacheSchema.safeParse(routeCache);\n//     const parsedStatus = StorefrontStatusCacheSchema.safeParse(statusCache);\n//     return {\n//       // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n//       node: parsedRoute.success ? (parsedRoute.data.node as Node) : undefined,\n//       status: parsedStatus.success ? parsedStatus.data.status : undefined,\n//     };\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//     return {\n//       node: undefined,\n//       status: undefined,\n//     };\n//   }\n// };\n// const setKvStatus = async (status?: StorefrontStatusType | null) => {\n//   try {\n//     const expiryTime = Date.now() + 1000 * 60 * 5; // 5 minutes;\n//     await kv.set(STORE_STATUS_KEY, { status, expiryTime });\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//   }\n// };\n// const setKvRoute = async (request: NextRequest, node: Node) => {\n//   try {\n//     const expiryTime = Date.now() + 1000 * 60 * 30; // 30 minutes;\n//     await kv.set(request.nextUrl.pathname, { node, expiryTime });\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//   }\n// };\n// const getRouteInfo = async (request: NextRequest) => {\n//   try {\n//     let { node, status } = await getExistingRouteInfo(request);\n//     if (status === undefined) {\n//       const newStatus = await getStoreStatus();\n//       if (newStatus) {\n//         status = newStatus;\n//         await setKvStatus(status);\n//       }\n//     }\n//     if (node === undefined) {\n//       const newNode = await getRoute(request.nextUrl.pathname);\n//       node = newNode;\n//       await setKvRoute(request, node);\n//     }\n//     return { node, status };\n//   } catch (error) {\n//     // eslint-disable-next-line no-console\n//     console.error(error);\n//     return {\n//       node: undefined,\n//       status: undefined,\n//     };\n//   }\n// };\n// export const withCustomUrls: MiddlewareFactory = (next) => {\n//   return async (request, event) => {\n//     const { node, status } = await getRouteInfo(request);\n//     if (status === 'MAINTENANCE') {\n//       // 503 status code not working - https://github.com/vercel/next.js/issues/50155\n//       return NextResponse.rewrite(new URL(`/maintenance`, request.url), { status: 503 });\n//     }\n//     const customerId = await getSessionCustomerId();\n//     const cartId = cookies().get('cartId');\n//     let postfix = '';\n//     if (!request.nextUrl.search && !customerId && !cartId && request.method === 'GET') {\n//       postfix = '/static';\n//     }\n//     // Rewrite / to /lookbook -- ARIZON\n//     if (request.nextUrl.pathname === '/') {\n//       return NextResponse.rewrite(new URL('/page', request.url));\n//     }\n//     switch (node?.__typename) {\n//       case 'Brand': {\n//         const url = createRewriteUrl(`/brand/${node.entityId}${postfix}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       case 'Category': {\n//         const url = createRewriteUrl(`/category/${node.entityId}${postfix}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       case 'Product': {\n//         const url = createRewriteUrl(`/product/${node.entityId}${postfix}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       case 'ContactPage':\n//       case 'NormalPage': {\n//         const { pathname } = new URL(request.url);\n//         const url = createRewriteUrl(`/bc-page${pathname}`, request);\n//         return NextResponse.rewrite(url);\n//       }\n//       default: {\n//         const { pathname } = new URL(request.url);\n//         if (pathname === '/' && postfix) {\n//           const url = createRewriteUrl(postfix, request);\n//           return NextResponse.rewrite(url);\n//         }\n//         return next(request, event);\n//       }\n//     }\n//   };\n// };\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vbWlkZGxld2FyZXMvd2l0aC1jdXN0b20tdXJscy50cz81N2JhIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7IGNvb2tpZXMgfSBmcm9tICduZXh0L2hlYWRlcnMnO1xuLy8gaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbi8vIGltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG4vLyBpbXBvcnQgeyBnZXRTZXNzaW9uQ3VzdG9tZXJJZCB9IGZyb20gJ34vYXV0aCc7XG4vLyBpbXBvcnQgeyBTdG9yZWZyb250U3RhdHVzVHlwZSB9IGZyb20gJ34vY2xpZW50L2dlbmVyYXRlZC9ncmFwaHFsJztcbi8vIGltcG9ydCB7IGdldFJvdXRlIH0gZnJvbSAnfi9jbGllbnQvcXVlcmllcy9nZXQtcm91dGUnO1xuLy8gaW1wb3J0IHsgZ2V0U3RvcmVTdGF0dXMgfSBmcm9tICd+L2NsaWVudC9xdWVyaWVzL2dldC1zdG9yZS1zdGF0dXMnO1xuXG4vLyBpbXBvcnQgeyBrdiB9IGZyb20gJy4uL2xpYi9rdic7XG5cbi8vIGltcG9ydCB7IHR5cGUgTWlkZGxld2FyZUZhY3RvcnkgfSBmcm9tICcuL2NvbXBvc2UtbWlkZGxld2FyZXMnO1xuXG4vLyB0eXBlIE5vZGUgPSBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIGdldFJvdXRlPj47XG5cbi8vIGludGVyZmFjZSBSb3V0ZUNhY2hlIHtcbi8vICAgbm9kZTogTm9kZTtcbi8vICAgZXhwaXJ5VGltZTogbnVtYmVyO1xuLy8gfVxuXG4vLyBjb25zdCBTVE9SRV9TVEFUVVNfS0VZID0gJ3N0b3JlU3RhdHVzJztcblxuLy8gaW50ZXJmYWNlIFN0b3JlZnJvbnRTdGF0dXNDYWNoZSB7XG4vLyAgIHN0YXR1czogU3RvcmVmcm9udFN0YXR1c1R5cGU7XG4vLyAgIGV4cGlyeVRpbWU6IG51bWJlcjtcbi8vIH1cblxuLy8gY29uc3QgY3JlYXRlUmV3cml0ZVVybCA9IChwYXRoOiBzdHJpbmcsIHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSA9PiB7XG4vLyAgIGNvbnN0IHVybCA9IG5ldyBVUkwocGF0aCwgcmVxdWVzdC51cmwpO1xuXG4vLyAgIHVybC5zZWFyY2ggPSByZXF1ZXN0Lm5leHRVcmwuc2VhcmNoO1xuXG4vLyAgIHJldHVybiB1cmw7XG4vLyB9O1xuXG4vLyBjb25zdCBTdG9yZWZyb250U3RhdHVzQ2FjaGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4vLyAgIHN0YXR1czogei5uYXRpdmVFbnVtKFN0b3JlZnJvbnRTdGF0dXNUeXBlKSxcbi8vICAgZXhwaXJ5VGltZTogei5udW1iZXIoKSxcbi8vIH0pO1xuXG4vLyBjb25zdCBSb3V0ZUNhY2hlU2NoZW1hID0gei5vYmplY3Qoe1xuLy8gICBub2RlOiB6Lm51bGxhYmxlKHoub2JqZWN0KHsgX190eXBlbmFtZTogei5zdHJpbmcoKSwgZW50aXR5SWQ6IHoub3B0aW9uYWwoei5udW1iZXIoKSkgfSkpLFxuLy8gICBleHBpcnlUaW1lOiB6Lm51bWJlcigpLFxuLy8gfSk7XG5cbi8vIGNvbnN0IGdldEV4aXN0aW5nUm91dGVJbmZvID0gYXN5bmMgKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSA9PiB7XG4vLyAgIHRyeSB7XG4vLyAgICAgY29uc3QgcGF0aG5hbWUgPSByZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWU7XG5cbi8vICAgICBjb25zdCBbcm91dGVDYWNoZSwgc3RhdHVzQ2FjaGVdID0gYXdhaXQga3YubWdldDxSb3V0ZUNhY2hlIHwgU3RvcmVmcm9udFN0YXR1c0NhY2hlPihcbi8vICAgICAgIHBhdGhuYW1lLFxuLy8gICAgICAgU1RPUkVfU1RBVFVTX0tFWSxcbi8vICAgICApO1xuXG4vLyAgICAgaWYgKHN0YXR1c0NhY2hlICYmIHN0YXR1c0NhY2hlLmV4cGlyeVRpbWUgPCBEYXRlLm5vdygpKSB7XG4vLyAgICAgICB2b2lkIGZldGNoKG5ldyBVUkwoYC9hcGkvcmV2YWxpZGF0ZS9zdG9yZS1zdGF0dXNgLCByZXF1ZXN0LnVybCksIHtcbi8vICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4vLyAgICAgICAgIGhlYWRlcnM6IHtcbi8vICAgICAgICAgICAneC1pbnRlcm5hbC10b2tlbic6IHByb2Nlc3MuZW52LkJJR0NPTU1FUkNFX0NVU1RPTUVSX0lNUEVSU09OQVRJT05fVE9LRU4gPz8gJycsXG4vLyAgICAgICAgIH0sXG4vLyAgICAgICB9KTtcbi8vICAgICB9XG5cbi8vICAgICBpZiAocm91dGVDYWNoZSAmJiByb3V0ZUNhY2hlLmV4cGlyeVRpbWUgPCBEYXRlLm5vdygpKSB7XG4vLyAgICAgICB2b2lkIGZldGNoKG5ldyBVUkwoYC9hcGkvcmV2YWxpZGF0ZS9yb3V0ZWAsIHJlcXVlc3QudXJsKSwge1xuLy8gICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbi8vICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBwYXRobmFtZSB9KSxcbi8vICAgICAgICAgaGVhZGVyczoge1xuLy8gICAgICAgICAgICd4LWludGVybmFsLXRva2VuJzogcHJvY2Vzcy5lbnYuQklHQ09NTUVSQ0VfQ1VTVE9NRVJfSU1QRVJTT05BVElPTl9UT0tFTiA/PyAnJyxcbi8vICAgICAgICAgfSxcbi8vICAgICAgIH0pO1xuLy8gICAgIH1cblxuLy8gICAgIGNvbnN0IHBhcnNlZFJvdXRlID0gUm91dGVDYWNoZVNjaGVtYS5zYWZlUGFyc2Uocm91dGVDYWNoZSk7XG4vLyAgICAgY29uc3QgcGFyc2VkU3RhdHVzID0gU3RvcmVmcm9udFN0YXR1c0NhY2hlU2NoZW1hLnNhZmVQYXJzZShzdGF0dXNDYWNoZSk7XG5cbi8vICAgICByZXR1cm4ge1xuLy8gICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9jb25zaXN0ZW50LXR5cGUtYXNzZXJ0aW9uc1xuLy8gICAgICAgbm9kZTogcGFyc2VkUm91dGUuc3VjY2VzcyA/IChwYXJzZWRSb3V0ZS5kYXRhLm5vZGUgYXMgTm9kZSkgOiB1bmRlZmluZWQsXG4vLyAgICAgICBzdGF0dXM6IHBhcnNlZFN0YXR1cy5zdWNjZXNzID8gcGFyc2VkU3RhdHVzLmRhdGEuc3RhdHVzIDogdW5kZWZpbmVkLFxuLy8gICAgIH07XG4vLyAgIH0gY2F0Y2ggKGVycm9yKSB7XG4vLyAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbi8vICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcblxuLy8gICAgIHJldHVybiB7XG4vLyAgICAgICBub2RlOiB1bmRlZmluZWQsXG4vLyAgICAgICBzdGF0dXM6IHVuZGVmaW5lZCxcbi8vICAgICB9O1xuLy8gICB9XG4vLyB9O1xuXG4vLyBjb25zdCBzZXRLdlN0YXR1cyA9IGFzeW5jIChzdGF0dXM/OiBTdG9yZWZyb250U3RhdHVzVHlwZSB8IG51bGwpID0+IHtcbi8vICAgdHJ5IHtcbi8vICAgICBjb25zdCBleHBpcnlUaW1lID0gRGF0ZS5ub3coKSArIDEwMDAgKiA2MCAqIDU7IC8vIDUgbWludXRlcztcblxuLy8gICAgIGF3YWl0IGt2LnNldChTVE9SRV9TVEFUVVNfS0VZLCB7IHN0YXR1cywgZXhwaXJ5VGltZSB9KTtcbi8vICAgfSBjYXRjaCAoZXJyb3IpIHtcbi8vICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuLy8gICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuLy8gICB9XG4vLyB9O1xuXG4vLyBjb25zdCBzZXRLdlJvdXRlID0gYXN5bmMgKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBub2RlOiBOb2RlKSA9PiB7XG4vLyAgIHRyeSB7XG4vLyAgICAgY29uc3QgZXhwaXJ5VGltZSA9IERhdGUubm93KCkgKyAxMDAwICogNjAgKiAzMDsgLy8gMzAgbWludXRlcztcblxuLy8gICAgIGF3YWl0IGt2LnNldChyZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUsIHsgbm9kZSwgZXhwaXJ5VGltZSB9KTtcbi8vICAgfSBjYXRjaCAoZXJyb3IpIHtcbi8vICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuLy8gICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuLy8gICB9XG4vLyB9O1xuXG4vLyBjb25zdCBnZXRSb3V0ZUluZm8gPSBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpID0+IHtcbi8vICAgdHJ5IHtcbi8vICAgICBsZXQgeyBub2RlLCBzdGF0dXMgfSA9IGF3YWl0IGdldEV4aXN0aW5nUm91dGVJbmZvKHJlcXVlc3QpO1xuXG4vLyAgICAgaWYgKHN0YXR1cyA9PT0gdW5kZWZpbmVkKSB7XG4vLyAgICAgICBjb25zdCBuZXdTdGF0dXMgPSBhd2FpdCBnZXRTdG9yZVN0YXR1cygpO1xuXG4vLyAgICAgICBpZiAobmV3U3RhdHVzKSB7XG4vLyAgICAgICAgIHN0YXR1cyA9IG5ld1N0YXR1cztcbi8vICAgICAgICAgYXdhaXQgc2V0S3ZTdGF0dXMoc3RhdHVzKTtcbi8vICAgICAgIH1cbi8vICAgICB9XG5cbi8vICAgICBpZiAobm9kZSA9PT0gdW5kZWZpbmVkKSB7XG4vLyAgICAgICBjb25zdCBuZXdOb2RlID0gYXdhaXQgZ2V0Um91dGUocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lKTtcblxuLy8gICAgICAgbm9kZSA9IG5ld05vZGU7XG4vLyAgICAgICBhd2FpdCBzZXRLdlJvdXRlKHJlcXVlc3QsIG5vZGUpO1xuLy8gICAgIH1cblxuLy8gICAgIHJldHVybiB7IG5vZGUsIHN0YXR1cyB9O1xuLy8gICB9IGNhdGNoIChlcnJvcikge1xuLy8gICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4vLyAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG5cbi8vICAgICByZXR1cm4ge1xuLy8gICAgICAgbm9kZTogdW5kZWZpbmVkLFxuLy8gICAgICAgc3RhdHVzOiB1bmRlZmluZWQsXG4vLyAgICAgfTtcbi8vICAgfVxuLy8gfTtcblxuLy8gZXhwb3J0IGNvbnN0IHdpdGhDdXN0b21VcmxzOiBNaWRkbGV3YXJlRmFjdG9yeSA9IChuZXh0KSA9PiB7XG4vLyAgIHJldHVybiBhc3luYyAocmVxdWVzdCwgZXZlbnQpID0+IHtcbi8vICAgICBjb25zdCB7IG5vZGUsIHN0YXR1cyB9ID0gYXdhaXQgZ2V0Um91dGVJbmZvKHJlcXVlc3QpO1xuXG4vLyAgICAgaWYgKHN0YXR1cyA9PT0gJ01BSU5URU5BTkNFJykge1xuLy8gICAgICAgLy8gNTAzIHN0YXR1cyBjb2RlIG5vdCB3b3JraW5nIC0gaHR0cHM6Ly9naXRodWIuY29tL3ZlcmNlbC9uZXh0LmpzL2lzc3Vlcy81MDE1NVxuLy8gICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZXdyaXRlKG5ldyBVUkwoYC9tYWludGVuYW5jZWAsIHJlcXVlc3QudXJsKSwgeyBzdGF0dXM6IDUwMyB9KTtcbi8vICAgICB9XG5cbi8vICAgICBjb25zdCBjdXN0b21lcklkID0gYXdhaXQgZ2V0U2Vzc2lvbkN1c3RvbWVySWQoKTtcbi8vICAgICBjb25zdCBjYXJ0SWQgPSBjb29raWVzKCkuZ2V0KCdjYXJ0SWQnKTtcbi8vICAgICBsZXQgcG9zdGZpeCA9ICcnO1xuXG4vLyAgICAgaWYgKCFyZXF1ZXN0Lm5leHRVcmwuc2VhcmNoICYmICFjdXN0b21lcklkICYmICFjYXJ0SWQgJiYgcmVxdWVzdC5tZXRob2QgPT09ICdHRVQnKSB7XG4vLyAgICAgICBwb3N0Zml4ID0gJy9zdGF0aWMnO1xuLy8gICAgIH1cblxuLy8gICAgIHN3aXRjaCAobm9kZT8uX190eXBlbmFtZSkge1xuLy8gICAgICAgY2FzZSAnQnJhbmQnOiB7XG4vLyAgICAgICAgIGNvbnN0IHVybCA9IGNyZWF0ZVJld3JpdGVVcmwoYC9icmFuZC8ke25vZGUuZW50aXR5SWR9JHtwb3N0Zml4fWAsIHJlcXVlc3QpO1xuXG4vLyAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmV3cml0ZSh1cmwpO1xuLy8gICAgICAgfVxuXG4vLyAgICAgICBjYXNlICdDYXRlZ29yeSc6IHtcbi8vICAgICAgICAgY29uc3QgdXJsID0gY3JlYXRlUmV3cml0ZVVybChgL2NhdGVnb3J5LyR7bm9kZS5lbnRpdHlJZH0ke3Bvc3RmaXh9YCwgcmVxdWVzdCk7XG5cbi8vICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZXdyaXRlKHVybCk7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIGNhc2UgJ1Byb2R1Y3QnOiB7XG4vLyAgICAgICAgIGNvbnN0IHVybCA9IGNyZWF0ZVJld3JpdGVVcmwoYC9wcm9kdWN0LyR7bm9kZS5lbnRpdHlJZH0ke3Bvc3RmaXh9YCwgcmVxdWVzdCk7XG5cbi8vICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZXdyaXRlKHVybCk7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIGNhc2UgJ0NvbnRhY3RQYWdlJzpcbi8vICAgICAgIGNhc2UgJ05vcm1hbFBhZ2UnOiB7XG4vLyAgICAgICAgIGNvbnN0IHsgcGF0aG5hbWUgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuLy8gICAgICAgICBjb25zdCB1cmwgPSBjcmVhdGVSZXdyaXRlVXJsKGAvYmMtcGFnZSR7cGF0aG5hbWV9YCwgcmVxdWVzdCk7XG5cbi8vICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZXdyaXRlKHVybCk7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIGRlZmF1bHQ6IHtcbi8vICAgICAgICAgY29uc3QgeyBwYXRobmFtZSB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG5cbi8vICAgICAgICAgaWYgKHBhdGhuYW1lID09PSAnLycgJiYgcG9zdGZpeCkge1xuLy8gICAgICAgICAgIGNvbnN0IHVybCA9IGNyZWF0ZVJld3JpdGVVcmwocG9zdGZpeCwgcmVxdWVzdCk7XG5cbi8vICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJld3JpdGUodXJsKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIHJldHVybiBuZXh0KHJlcXVlc3QsIGV2ZW50KTtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgIH07XG4vLyB9O1xuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuLy8gaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG4vLyBpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuLy8gaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbi8vIGltcG9ydCB7IGdldFNlc3Npb25DdXN0b21lcklkIH0gZnJvbSAnfi9hdXRoJztcbi8vIGltcG9ydCB7IFN0b3JlZnJvbnRTdGF0dXNUeXBlIH0gZnJvbSAnfi9jbGllbnQvZ2VuZXJhdGVkL2dyYXBocWwnO1xuLy8gaW1wb3J0IHsgZ2V0Um91dGUgfSBmcm9tICd+L2NsaWVudC9xdWVyaWVzL2dldC1yb3V0ZSc7XG4vLyBpbXBvcnQgeyBnZXRTdG9yZVN0YXR1cyB9IGZyb20gJ34vY2xpZW50L3F1ZXJpZXMvZ2V0LXN0b3JlLXN0YXR1cyc7XG5cbi8vIGltcG9ydCB7IGt2IH0gZnJvbSAnLi4vbGliL2t2JztcblxuLy8gaW1wb3J0IHsgdHlwZSBNaWRkbGV3YXJlRmFjdG9yeSB9IGZyb20gJy4vY29tcG9zZS1taWRkbGV3YXJlcyc7XG5cbi8vIHR5cGUgTm9kZSA9IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgZ2V0Um91dGU+PjtcblxuLy8gaW50ZXJmYWNlIFJvdXRlQ2FjaGUge1xuLy8gICBub2RlOiBOb2RlO1xuLy8gICBleHBpcnlUaW1lOiBudW1iZXI7XG4vLyB9XG5cbi8vIGNvbnN0IFNUT1JFX1NUQVRVU19LRVkgPSAnc3RvcmVTdGF0dXMnO1xuXG4vLyBpbnRlcmZhY2UgU3RvcmVmcm9udFN0YXR1c0NhY2hlIHtcbi8vICAgc3RhdHVzOiBTdG9yZWZyb250U3RhdHVzVHlwZTtcbi8vICAgZXhwaXJ5VGltZTogbnVtYmVyO1xuLy8gfVxuXG4vLyBjb25zdCBjcmVhdGVSZXdyaXRlVXJsID0gKHBhdGg6IHN0cmluZywgcmVxdWVzdDogTmV4dFJlcXVlc3QpID0+IHtcbi8vICAgY29uc3QgdXJsID0gbmV3IFVSTChwYXRoLCByZXF1ZXN0LnVybCk7XG5cbi8vICAgdXJsLnNlYXJjaCA9IHJlcXVlc3QubmV4dFVybC5zZWFyY2g7XG5cbi8vICAgcmV0dXJuIHVybDtcbi8vIH07XG5cbi8vIGNvbnN0IFN0b3JlZnJvbnRTdGF0dXNDYWNoZVNjaGVtYSA9IHoub2JqZWN0KHtcbi8vICAgc3RhdHVzOiB6Lm5hdGl2ZUVudW0oU3RvcmVmcm9udFN0YXR1c1R5cGUpLFxuLy8gICBleHBpcnlUaW1lOiB6Lm51bWJlcigpLFxuLy8gfSk7XG5cbi8vIGNvbnN0IFJvdXRlQ2FjaGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4vLyAgIG5vZGU6IHoubnVsbGFibGUoei5vYmplY3QoeyBfX3R5cGVuYW1lOiB6LnN0cmluZygpLCBlbnRpdHlJZDogei5vcHRpb25hbCh6Lm51bWJlcigpKSB9KSksXG4vLyAgIGV4cGlyeVRpbWU6IHoubnVtYmVyKCksXG4vLyB9KTtcblxuLy8gY29uc3QgZ2V0RXhpc3RpbmdSb3V0ZUluZm8gPSBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpID0+IHtcbi8vICAgdHJ5IHtcbi8vICAgICBjb25zdCBwYXRobmFtZSA9IHJlcXVlc3QubmV4dFVybC5wYXRobmFtZTtcblxuLy8gICAgIGNvbnN0IFtyb3V0ZUNhY2hlLCBzdGF0dXNDYWNoZV0gPSBhd2FpdCBrdi5tZ2V0PFJvdXRlQ2FjaGUgfCBTdG9yZWZyb250U3RhdHVzQ2FjaGU+KFxuLy8gICAgICAgcGF0aG5hbWUsXG4vLyAgICAgICBTVE9SRV9TVEFUVVNfS0VZLFxuLy8gICAgICk7XG5cbi8vICAgICBpZiAoc3RhdHVzQ2FjaGUgJiYgc3RhdHVzQ2FjaGUuZXhwaXJ5VGltZSA8IERhdGUubm93KCkpIHtcbi8vICAgICAgIHZvaWQgZmV0Y2gobmV3IFVSTChgL2FwaS9yZXZhbGlkYXRlL3N0b3JlLXN0YXR1c2AsIHJlcXVlc3QudXJsKSwge1xuLy8gICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbi8vICAgICAgICAgaGVhZGVyczoge1xuLy8gICAgICAgICAgICd4LWludGVybmFsLXRva2VuJzogcHJvY2Vzcy5lbnYuQklHQ09NTUVSQ0VfQ1VTVE9NRVJfSU1QRVJTT05BVElPTl9UT0tFTiA/PyAnJyxcbi8vICAgICAgICAgfSxcbi8vICAgICAgIH0pO1xuLy8gICAgIH1cblxuLy8gICAgIGlmIChyb3V0ZUNhY2hlICYmIHJvdXRlQ2FjaGUuZXhwaXJ5VGltZSA8IERhdGUubm93KCkpIHtcbi8vICAgICAgIHZvaWQgZmV0Y2gobmV3IFVSTChgL2FwaS9yZXZhbGlkYXRlL3JvdXRlYCwgcmVxdWVzdC51cmwpLCB7XG4vLyAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuLy8gICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHBhdGhuYW1lIH0pLFxuLy8gICAgICAgICBoZWFkZXJzOiB7XG4vLyAgICAgICAgICAgJ3gtaW50ZXJuYWwtdG9rZW4nOiBwcm9jZXNzLmVudi5CSUdDT01NRVJDRV9DVVNUT01FUl9JTVBFUlNPTkFUSU9OX1RPS0VOID8/ICcnLFxuLy8gICAgICAgICB9LFxuLy8gICAgICAgfSk7XG4vLyAgICAgfVxuXG4vLyAgICAgY29uc3QgcGFyc2VkUm91dGUgPSBSb3V0ZUNhY2hlU2NoZW1hLnNhZmVQYXJzZShyb3V0ZUNhY2hlKTtcbi8vICAgICBjb25zdCBwYXJzZWRTdGF0dXMgPSBTdG9yZWZyb250U3RhdHVzQ2FjaGVTY2hlbWEuc2FmZVBhcnNlKHN0YXR1c0NhY2hlKTtcblxuLy8gICAgIHJldHVybiB7XG4vLyAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2NvbnNpc3RlbnQtdHlwZS1hc3NlcnRpb25zXG4vLyAgICAgICBub2RlOiBwYXJzZWRSb3V0ZS5zdWNjZXNzID8gKHBhcnNlZFJvdXRlLmRhdGEubm9kZSBhcyBOb2RlKSA6IHVuZGVmaW5lZCxcbi8vICAgICAgIHN0YXR1czogcGFyc2VkU3RhdHVzLnN1Y2Nlc3MgPyBwYXJzZWRTdGF0dXMuZGF0YS5zdGF0dXMgOiB1bmRlZmluZWQsXG4vLyAgICAgfTtcbi8vICAgfSBjYXRjaCAoZXJyb3IpIHtcbi8vICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuLy8gICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXG4vLyAgICAgcmV0dXJuIHtcbi8vICAgICAgIG5vZGU6IHVuZGVmaW5lZCxcbi8vICAgICAgIHN0YXR1czogdW5kZWZpbmVkLFxuLy8gICAgIH07XG4vLyAgIH1cbi8vIH07XG5cbi8vIGNvbnN0IHNldEt2U3RhdHVzID0gYXN5bmMgKHN0YXR1cz86IFN0b3JlZnJvbnRTdGF0dXNUeXBlIHwgbnVsbCkgPT4ge1xuLy8gICB0cnkge1xuLy8gICAgIGNvbnN0IGV4cGlyeVRpbWUgPSBEYXRlLm5vdygpICsgMTAwMCAqIDYwICogNTsgLy8gNSBtaW51dGVzO1xuXG4vLyAgICAgYXdhaXQga3Yuc2V0KFNUT1JFX1NUQVRVU19LRVksIHsgc3RhdHVzLCBleHBpcnlUaW1lIH0pO1xuLy8gICB9IGNhdGNoIChlcnJvcikge1xuLy8gICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4vLyAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4vLyAgIH1cbi8vIH07XG5cbi8vIGNvbnN0IHNldEt2Um91dGUgPSBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QsIG5vZGU6IE5vZGUpID0+IHtcbi8vICAgdHJ5IHtcbi8vICAgICBjb25zdCBleHBpcnlUaW1lID0gRGF0ZS5ub3coKSArIDEwMDAgKiA2MCAqIDMwOyAvLyAzMCBtaW51dGVzO1xuXG4vLyAgICAgYXdhaXQga3Yuc2V0KHJlcXVlc3QubmV4dFVybC5wYXRobmFtZSwgeyBub2RlLCBleHBpcnlUaW1lIH0pO1xuLy8gICB9IGNhdGNoIChlcnJvcikge1xuLy8gICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4vLyAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4vLyAgIH1cbi8vIH07XG5cbi8vIGNvbnN0IGdldFJvdXRlSW5mbyA9IGFzeW5jIChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkgPT4ge1xuLy8gICB0cnkge1xuLy8gICAgIGxldCB7IG5vZGUsIHN0YXR1cyB9ID0gYXdhaXQgZ2V0RXhpc3RpbmdSb3V0ZUluZm8ocmVxdWVzdCk7XG5cbi8vICAgICBpZiAoc3RhdHVzID09PSB1bmRlZmluZWQpIHtcbi8vICAgICAgIGNvbnN0IG5ld1N0YXR1cyA9IGF3YWl0IGdldFN0b3JlU3RhdHVzKCk7XG5cbi8vICAgICAgIGlmIChuZXdTdGF0dXMpIHtcbi8vICAgICAgICAgc3RhdHVzID0gbmV3U3RhdHVzO1xuLy8gICAgICAgICBhd2FpdCBzZXRLdlN0YXR1cyhzdGF0dXMpO1xuLy8gICAgICAgfVxuLy8gICAgIH1cblxuLy8gICAgIGlmIChub2RlID09PSB1bmRlZmluZWQpIHtcbi8vICAgICAgIGNvbnN0IG5ld05vZGUgPSBhd2FpdCBnZXRSb3V0ZShyZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUpO1xuXG4vLyAgICAgICBub2RlID0gbmV3Tm9kZTtcbi8vICAgICAgIGF3YWl0IHNldEt2Um91dGUocmVxdWVzdCwgbm9kZSk7XG4vLyAgICAgfVxuXG4vLyAgICAgcmV0dXJuIHsgbm9kZSwgc3RhdHVzIH07XG4vLyAgIH0gY2F0Y2ggKGVycm9yKSB7XG4vLyAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbi8vICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcblxuLy8gICAgIHJldHVybiB7XG4vLyAgICAgICBub2RlOiB1bmRlZmluZWQsXG4vLyAgICAgICBzdGF0dXM6IHVuZGVmaW5lZCxcbi8vICAgICB9O1xuLy8gICB9XG4vLyB9O1xuXG4vLyBleHBvcnQgY29uc3Qgd2l0aEN1c3RvbVVybHM6IE1pZGRsZXdhcmVGYWN0b3J5ID0gKG5leHQpID0+IHtcbi8vICAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBldmVudCkgPT4ge1xuLy8gICAgIGNvbnN0IHsgbm9kZSwgc3RhdHVzIH0gPSBhd2FpdCBnZXRSb3V0ZUluZm8ocmVxdWVzdCk7XG5cbi8vICAgICBpZiAoc3RhdHVzID09PSAnTUFJTlRFTkFOQ0UnKSB7XG4vLyAgICAgICAvLyA1MDMgc3RhdHVzIGNvZGUgbm90IHdvcmtpbmcgLSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanMvaXNzdWVzLzUwMTU1XG4vLyAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJld3JpdGUobmV3IFVSTChgL21haW50ZW5hbmNlYCwgcmVxdWVzdC51cmwpLCB7IHN0YXR1czogNTAzIH0pO1xuLy8gICAgIH1cblxuLy8gICAgIGNvbnN0IGN1c3RvbWVySWQgPSBhd2FpdCBnZXRTZXNzaW9uQ3VzdG9tZXJJZCgpO1xuLy8gICAgIGNvbnN0IGNhcnRJZCA9IGNvb2tpZXMoKS5nZXQoJ2NhcnRJZCcpO1xuLy8gICAgIGxldCBwb3N0Zml4ID0gJyc7XG5cbi8vICAgICBpZiAoIXJlcXVlc3QubmV4dFVybC5zZWFyY2ggJiYgIWN1c3RvbWVySWQgJiYgIWNhcnRJZCAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gJ0dFVCcpIHtcbi8vICAgICAgIHBvc3RmaXggPSAnL3N0YXRpYyc7XG4vLyAgICAgfVxuXG5cblxuXG5cblxuXG5cblxuXG4vLyAgICAgLy8gUmV3cml0ZSAvIHRvIC9sb29rYm9vayAtLSBBUklaT05cbi8vICAgICBpZiAocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lID09PSAnLycpIHtcbi8vICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmV3cml0ZShuZXcgVVJMKCcvcGFnZScsIHJlcXVlc3QudXJsKSk7XG4vLyAgICAgfVxuXG5cblxuXG5cblxuXG4gICAgXG5cbi8vICAgICBzd2l0Y2ggKG5vZGU/Ll9fdHlwZW5hbWUpIHtcbi8vICAgICAgIGNhc2UgJ0JyYW5kJzoge1xuLy8gICAgICAgICBjb25zdCB1cmwgPSBjcmVhdGVSZXdyaXRlVXJsKGAvYnJhbmQvJHtub2RlLmVudGl0eUlkfSR7cG9zdGZpeH1gLCByZXF1ZXN0KTtcblxuLy8gICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJld3JpdGUodXJsKTtcbi8vICAgICAgIH1cblxuLy8gICAgICAgY2FzZSAnQ2F0ZWdvcnknOiB7XG4vLyAgICAgICAgIGNvbnN0IHVybCA9IGNyZWF0ZVJld3JpdGVVcmwoYC9jYXRlZ29yeS8ke25vZGUuZW50aXR5SWR9JHtwb3N0Zml4fWAsIHJlcXVlc3QpO1xuXG4vLyAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmV3cml0ZSh1cmwpO1xuLy8gICAgICAgfVxuXG4vLyAgICAgICBjYXNlICdQcm9kdWN0Jzoge1xuLy8gICAgICAgICBjb25zdCB1cmwgPSBjcmVhdGVSZXdyaXRlVXJsKGAvcHJvZHVjdC8ke25vZGUuZW50aXR5SWR9JHtwb3N0Zml4fWAsIHJlcXVlc3QpO1xuXG4vLyAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmV3cml0ZSh1cmwpO1xuLy8gICAgICAgfVxuXG4vLyAgICAgICBjYXNlICdDb250YWN0UGFnZSc6XG4vLyAgICAgICBjYXNlICdOb3JtYWxQYWdlJzoge1xuLy8gICAgICAgICBjb25zdCB7IHBhdGhuYW1lIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbi8vICAgICAgICAgY29uc3QgdXJsID0gY3JlYXRlUmV3cml0ZVVybChgL2JjLXBhZ2Uke3BhdGhuYW1lfWAsIHJlcXVlc3QpO1xuXG4vLyAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmV3cml0ZSh1cmwpO1xuLy8gICAgICAgfVxuXG4vLyAgICAgICBkZWZhdWx0OiB7XG4vLyAgICAgICAgIGNvbnN0IHsgcGF0aG5hbWUgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuXG4vLyAgICAgICAgIGlmIChwYXRobmFtZSA9PT0gJy8nICYmIHBvc3RmaXgpIHtcbi8vICAgICAgICAgICBjb25zdCB1cmwgPSBjcmVhdGVSZXdyaXRlVXJsKHBvc3RmaXgsIHJlcXVlc3QpO1xuXG4vLyAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZXdyaXRlKHVybCk7XG4vLyAgICAgICAgIH1cblxuLy8gICAgICAgICByZXR1cm4gbmV4dChyZXF1ZXN0LCBldmVudCk7XG4vLyAgICAgICB9XG4vLyAgICAgfVxuLy8gICB9O1xuLy8gfTtcblxuXG5cblxuXG5cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwwQ0FBMEM7QUFDMUMsMkRBQTJEO0FBQzNELDJCQUEyQjtBQUUzQixpREFBaUQ7QUFDakQscUVBQXFFO0FBQ3JFLHlEQUF5RDtBQUN6RCxzRUFBc0U7QUFFdEUsa0NBQWtDO0FBRWxDLGtFQUFrRTtBQUVsRSxvREFBb0Q7QUFFcEQseUJBQXlCO0FBQ3pCLGdCQUFnQjtBQUNoQix3QkFBd0I7QUFDeEIsSUFBSTtBQUVKLDBDQUEwQztBQUUxQyxvQ0FBb0M7QUFDcEMsa0NBQWtDO0FBQ2xDLHdCQUF3QjtBQUN4QixJQUFJO0FBRUoscUVBQXFFO0FBQ3JFLDRDQUE0QztBQUU1Qyx5Q0FBeUM7QUFFekMsZ0JBQWdCO0FBQ2hCLEtBQUs7QUFFTCxpREFBaUQ7QUFDakQsZ0RBQWdEO0FBQ2hELDRCQUE0QjtBQUM1QixNQUFNO0FBRU4sc0NBQXNDO0FBQ3RDLDhGQUE4RjtBQUM5Riw0QkFBNEI7QUFDNUIsTUFBTTtBQUVOLGlFQUFpRTtBQUNqRSxVQUFVO0FBQ1YsaURBQWlEO0FBRWpELDJGQUEyRjtBQUMzRixrQkFBa0I7QUFDbEIsMEJBQTBCO0FBQzFCLFNBQVM7QUFFVCxnRUFBZ0U7QUFDaEUsMkVBQTJFO0FBQzNFLDBCQUEwQjtBQUMxQixxQkFBcUI7QUFDckIsNEZBQTRGO0FBQzVGLGFBQWE7QUFDYixZQUFZO0FBQ1osUUFBUTtBQUVSLDhEQUE4RDtBQUM5RCxvRUFBb0U7QUFDcEUsMEJBQTBCO0FBQzFCLDhDQUE4QztBQUM5QyxxQkFBcUI7QUFDckIsNEZBQTRGO0FBQzVGLGFBQWE7QUFDYixZQUFZO0FBQ1osUUFBUTtBQUVSLGtFQUFrRTtBQUNsRSwrRUFBK0U7QUFFL0UsZUFBZTtB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Q0FBOEM7QUFDOUMsd0JBQXdCO0FBRXhCLDJGQUEyRjtBQUMzRiw2QkFBNkI7QUFDN0IsUUFBUTtBQVdSLDBDQUEwQztBQUMxQyw4Q0FBOEM7QUFDOUMsb0VBQW9FO0FBQ3BFLFFBQVE7QUFVUixrQ0FBa0M7QUFDbEMsd0JBQXdCO0FBQ3hCLHNGQUFzRjtBQUV0Riw0Q0FBNEM7QUFDNUMsVUFBVTtBQUVWLDJCQUEyQjtBQUMzQix5RkFBeUY7QUFFekYsNENBQTRDO0FBQzVDLFVBQVU7QUFFViwwQkFBMEI7QUFDMUIsd0ZBQXdGO0FBRXhGLDRDQUE0QztBQUM1QyxVQUFVO0FBRVYsNEJBQTRCO0FBQzVCLDZCQUE2QjtBQUM3QixxREFBcUQ7QUFDckQsd0VBQXdFO0FBRXhFLDRDQUE0QztBQUM1QyxVQUFVO0FBRVYsbUJBQW1CO0FBQ25CLHFEQUFxRDtBQUVyRCw2Q0FBNkM7QUFDN0MsNERBQTREO0FBRTVELDhDQUE4QztBQUM5QyxZQUFZO0FBRVosdUNBQXVDO0FBQ3ZDLFVBQVU7QUFDVixRQUFRO0FBQ1IsT0FBTztBQUNQLEtBQUsiLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZXMvd2l0aC1jdXN0b20tdXJscy50cyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./middlewares/with-custom-urls.ts\n");

/***/ })

});